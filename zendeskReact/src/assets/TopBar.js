import{u as A,r as i,j as e,F as M,a as D,b as $,c as E,d as _,e as v,f as U,g as N}from"./main.js";import{C as q}from"./ContactList.js";function H({calls:n=[]}){const{dispatch:b}=A(),[d,s]=i.useState(""),a=document.getElementById("zoomCCP"),p=i.useMemo(()=>n.map(t=>{var c,h,f,g,S,w;const x=t.direction==="inbound";return{id:t.callId||t.callLogId,type:t.direction==="inbound"?"incoming":t.direction==="outbound"?"outgoing":"missed",name:x?(c=t.caller)==null?void 0:c.name:(h=t.callee)==null?void 0:h.name,number:x?(f=t.caller)==null?void 0:f.number:(g=t.callee)==null?void 0:g.number,duration:t.duration||0,dateTime:t.dateTime,email:((S=t.caller)==null?void 0:S.email)||((w=t.callee)==null?void 0:w.email)||null,result:t.result}}),[n]),y=i.useMemo(()=>d.trim()?p.filter(t=>t.name&&t.name.toLowerCase().includes(d.toLowerCase())||t.number&&t.number.includes(d)||t.email&&t.email.toLowerCase().includes(d.toLowerCase())):p,[d,p]),l=t=>{if(!a){console.warn("Zoom CCP not found");return}a.contentWindow.postMessage({type:"zp-make-call",data:{number:t.number||""}},"https://applications.zoom.us")},m=t=>{if(!t||isNaN(t))return"0s";const x=Math.floor(t/60),c=t%60;return x>0?`${x}m ${c}s`:`${c}s`},j=["Missed","Call Cancel","Rejected","No Answer"];return e.jsxs("div",{style:{padding:8,fontFamily:"Segoe UI, sans-serif",height:"100%",overflowY:"auto",background:"var(--background)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{marginBottom:10},children:e.jsx("input",{type:"text",value:d,onChange:t=>s(t.target.value),placeholder:"Search recent calls...",style:{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid var(--input-border)",outline:"none",fontSize:14,backgroundColor:"var(--input-bg)",color:"var(--text-primary)"}})}),y.length>0?y.map((t,x)=>{const c=j.includes(t.result);return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"var(--surface)",padding:10,borderRadius:8,marginBottom:8,boxShadow:"0 1px 4px rgba(0,0,0,0.08)",color:"var(--text-primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{color:c?"#f44336":t.type==="incoming"?"#4caf50":"#2196f3",fontSize:18},children:c?e.jsx(M,{}):t.type==="incoming"?e.jsx(D,{}):e.jsx($,{})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("span",{style:{fontWeight:600},children:t.name||"Unknown"}),t.number&&e.jsx("span",{style:{fontSize:13,color:"var(--text-secondary)"},children:t.number}),t.email&&e.jsx("span",{style:{fontSize:12,color:"var(--text-secondary)"},children:t.email}),e.jsxs("span",{style:{fontSize:12,color:"var(--text-secondary)"},children:["Duration: ",m(t.duration)]})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,fontSize:16,cursor:"pointer"},children:[(!t.number||t.name==="Unknown")&&e.jsx(E,{title:"Add Contact",color:"#2196f3"}),t.number&&e.jsx(_,{title:"Call",onClick:()=>l(t),color:"#4caf50"})]})]},`${t.id}-${t.dateTime||x}`)}):e.jsx("p",{style:{textAlign:"center",color:"var(--text-secondary)",fontSize:14},children:"No recent calls found"})]})}function O({client:n,onClose:b,onTicketCreated:d}){const s=v(r=>r.common.callData),a=(s==null?void 0:s.callerNumber)||"",p=(s==null?void 0:s.callerName)||"",y=v(r=>r.common.single_contact),l=v(r=>{var C;return(C=r.ui)==null?void 0:C.darkMode})||!1,[m,j]=i.useState(""),[t,x]=i.useState("normal"),[c,h]=i.useState(""),[f,g]=i.useState(!1),S=U(),w=async r=>{var C;if(r.preventDefault(),!m.trim()){alert("Subject is required");return}try{g(!0);const z={ticket:{requester_id:(C=y[0])==null?void 0:C.id,subject:m.trim(),priority:t.toLowerCase(),comment:{body:c.trim()}}},T=await n.request({url:"/api/v2/tickets.json",type:"POST",contentType:"application/json",data:JSON.stringify(z)}),o=(T==null?void 0:T.ticket)||null;a&&await S(N(a)).unwrap(),d&&o&&(d(o),b())}catch(z){alert("Failed to create ticket: "+(z.message||"Unknown error"))}finally{g(!1)}},k=r=>{switch(r.toLowerCase()){case"low":return"#28a745";case"normal":return"#007bff";case"high":return"#ffc107";case"urgent":return"#dc3545";default:return"#007bff"}};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",padding:"20px",fontFamily:"Segoe UI, sans-serif",background:"var(--surface)",borderRadius:"12px",boxShadow:l?"0 4px 16px rgba(0,0,0,0.28)":"0 4px 12px rgba(0,0,0,0.08)",color:"var(--text-primary)",transition:"background 0.3s, color 0.3s"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"var(--text-primary)"},children:"Create Ticket"}),e.jsx("button",{onClick:b,style:{background:"transparent",border:"none",fontSize:"20px",cursor:"pointer",color:"var(--text-secondary)"},children:"âœ•"})]}),e.jsxs("div",{style:{marginBottom:"20px",padding:"12px",background:"var(--input-bg)",borderRadius:"8px",fontSize:"14px",color:"var(--text-secondary)",lineHeight:"1.5"},children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Caller:"})," ",p||"Unknown"," ",e.jsx("br",{}),e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Phone:"})," ",a||"N/A"]}),e.jsxs("form",{onSubmit:w,style:{display:"flex",flexDirection:"column",gap:"14px",flex:1},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"14px",marginBottom:"6px",fontWeight:500,color:"var(--text-secondary)"},children:"Subject"}),e.jsx("input",{type:"text",value:m,onChange:r=>j(r.target.value),placeholder:"Enter ticket subject",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:`1px solid ${l?"#555":"#ccc"}`,background:"var(--input-bg)",color:"var(--text-primary)",fontSize:"14px",outline:"none",transition:"0.2s border"},onFocus:r=>r.target.style.border="1px solid #0077ff",onBlur:r=>r.target.style.border=`1px solid ${l?"#555":"#ccc"}`})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"14px",marginBottom:"6px",fontWeight:500,color:"var(--text-secondary)"},children:"Priority"}),e.jsxs("select",{value:t,onChange:r=>x(r.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:`1px solid ${k(t)}`,background:"var(--input-bg)",color:k(t),fontWeight:600,fontSize:"14px",textTransform:"capitalize"},children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",marginBottom:"6px",fontWeight:500,color:"var(--text-secondary)"},children:"Description"}),e.jsx("textarea",{value:c,onChange:r=>h(r.target.value),rows:"4",placeholder:"Provide details about the issue...",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:`1px solid ${l?"#555":"#ccc"}`,background:"var(--input-bg)",color:"var(--text-primary)",fontSize:"14px",resize:"vertical",outline:"none"},onFocus:r=>r.target.style.border="1px solid #0077ff",onBlur:r=>r.target.style.border=`1px solid ${l?"#555":"#ccc"}`})]}),e.jsx("button",{type:"submit",disabled:f,style:{padding:"12px 16px",background:f?"#aaa":"#0077ff",color:"#fff",border:"none",borderRadius:"8px",cursor:f?"not-allowed":"pointer",fontSize:"15px",fontWeight:600,marginTop:"4px",transition:"0.2s background"},children:f?"Creating...":"Create Ticket"})]})]})}function J({client:n}){const[b,d]=i.useState([]),s=v(o=>o.common.callData),a=s==null?void 0:s.callerNumber,p=s==null?void 0:s.callerName,[y,l]=i.useState(!0),[m,j]=i.useState(""),[t,x]=i.useState(!1),[c,h]=i.useState(null),[f,g]=i.useState(""),S=U(),[w,k]=i.useState(null),r=v(o=>o.common.single_contact);v(o=>{var u;return(u=o.ui)==null?void 0:u.darkMode}),i.useEffect(()=>{if(!n||!a){j("Missing client or caller number"),l(!1);return}async function o(){l(!0),j("");try{const u=await S(N(a));if(N.fulfilled.match(u))d(u.payload);else throw new Error(u.payload||"Failed to fetch tickets")}catch(u){j("Failed to load tickets: "+(u.message||"Unknown error"))}finally{l(!1)}}o()},[n,a,S]);const C=async o=>{if(!f.trim())return alert("Please enter a note before submitting.");try{await n.request({url:`/api/v2/tickets/${o}.json`,type:"PUT",contentType:"application/json",data:JSON.stringify({ticket:{comment:{body:f,public:!1}}})}),alert("Note added successfully!"),h(null),g("")}catch(u){alert("Failed to add note: "+(u.message||"Unknown error"))}},z=o=>{o&&n.invoke("routeTo","ticket",o)},T=o=>{console.log("Attempting to open contact:",o,r[0].id),n.invoke("routeTo","user",r[0].id)};return y?e.jsx("p",{style:{padding:12},children:"Loading tickets..."}):m?e.jsx("p",{style:{padding:12,color:"var(--danger)"},children:m}):t?e.jsx(O,{client:n,onClose:()=>x(!1),onTicketCreated:o=>d([o,...b])}):e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",padding:16,fontFamily:"Segoe UI, sans-serif",background:"var(--background)",color:"var(--text-primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,background:"var(--surface)",borderRadius:16,marginBottom:16,boxShadow:"0 3px 8px rgba(0,0,0,0.08)",width:"100%"},children:[e.jsx("div",{style:{width:50,height:50,borderRadius:"50%",background:"var(--tab-button-active-bg)",color:"#fff",display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"bold",fontSize:20},children:p?p[0].toUpperCase():"?"}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",marginLeft:12,cursor:"pointer"},onClick:()=>T("1"),title:"Open Contact in Zendesk",children:[e.jsx("span",{style:{fontWeight:600,fontSize:16},children:p||"Unknown Caller"}),e.jsx("span",{style:{fontSize:14,color:"var(--text-secondary)"},children:a||"-"}),e.jsx("span",{style:{fontSize:12,color:"#28a745",fontWeight:500},children:"Connected"})]}),e.jsx("button",{onClick:()=>x(!0),style:{padding:"4px 10px",background:"linear-gradient(135deg, #4b6cb7 0%, #182848 100%)",color:"#fff",border:"none",borderRadius:20,fontSize:12,fontWeight:500,cursor:"pointer",boxShadow:"0 1px 5px rgba(0,0,0,0.2)",transition:"all 0.2s ease",userSelect:"none"},onMouseEnter:o=>o.currentTarget.style.opacity=.85,onMouseLeave:o=>o.currentTarget.style.opacity=1,type:"button",children:"+ Ticket"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:b.length===0?e.jsx("p",{style:{fontSize:14,color:"var(--text-secondary)"},children:"No tickets found"}):e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:12},children:b.map(o=>{var u,R,I,B,W,F;return e.jsxs("li",{style:{position:"relative",background:"var(--surface)",borderRadius:9,padding:16,boxShadow:"0 3px 8px rgba(0,0,0,0.08)",cursor:"pointer",transition:"all 0.2s ease",color:"var(--text-primary)"},onClick:()=>z(o.id),role:"button",tabIndex:0,children:[e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:15,display:"block",marginBottom:4},children:o.subject}),e.jsxs("div",{style:{display:"flex",gap:6,fontSize:11,alignItems:"center",marginTop:4,flexWrap:"wrap",color:"var(--text-secondary)"},children:[e.jsx("span",{style:{background:o.status.toLowerCase()==="open"?"#cce5ff":o.status.toLowerCase()==="pending"?"#fff3cd":o.status.toLowerCase()==="solved"?"#d4edda":"#e2e3e5",color:o.status.toLowerCase()==="open"?"#004085":o.status.toLowerCase()==="pending"?"#856404":o.status.toLowerCase()==="solved"?"#155724":"#6c757d",padding:"2px 6px",borderRadius:10,fontWeight:500,textTransform:"capitalize",transition:"all 0.2s ease"},title:o.status,children:o.status}),e.jsx("span",{style:{background:((u=o.priority)==null?void 0:u.toLowerCase())==="high"?"#f8d7da":((R=o.priority)==null?void 0:R.toLowerCase())==="medium"?"#fff3cd":((I=o.priority)==null?void 0:I.toLowerCase())==="low"?"#d4edda":"#e2e3e5",color:((B=o.priority)==null?void 0:B.toLowerCase())==="high"?"#721c24":((W=o.priority)==null?void 0:W.toLowerCase())==="medium"?"#856404":((F=o.priority)==null?void 0:F.toLowerCase())==="low"?"#155724":"#6c757d",padding:"2px 6px",borderRadius:10,fontWeight:500,textTransform:"capitalize",transition:"all 0.2s ease"},title:`Priority: ${o.priority||"Normal"}`,children:o.priority||"Normal"})]})]}),!c&&e.jsx("div",{style:{position:"absolute",top:8,right:8},children:e.jsxs("button",{onClick:L=>{L.stopPropagation(),h(o.id)},style:{background:"transparent",border:"none",color:"var(--tab-button-active-bg)",fontSize:18,fontWeight:"bold",cursor:"pointer",position:"relative",transition:"color 0.2s ease",userSelect:"none"},onMouseEnter:()=>k(o.id),onMouseLeave:()=>k(null),title:"Add Note",type:"button",children:["+",e.jsx("span",{style:{visibility:w===o.id?"visible":"hidden",opacity:w===o.id?1:0,backgroundColor:"#333",color:"#fff",textAlign:"center",borderRadius:6,padding:"4px 8px",position:"absolute",zIndex:1,top:28,right:0,fontSize:12,transition:"opacity 0.2s",whiteSpace:"nowrap"},children:"Add Note"})]})}),c===o.id&&e.jsxs("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:6},children:[e.jsx("textarea",{rows:2,value:f,onChange:L=>g(L.target.value),placeholder:"Write a note...",style:{width:"100%",padding:8,borderRadius:12,fontSize:13,border:"1px solid var(--input-border)",resize:"none",outline:"none",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.1)",backgroundColor:"var(--input-bg)",color:"var(--text-primary)"}}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>C(o.id),style:{padding:"4px 12px",background:"var(--success)",color:"#fff",border:"none",borderRadius:20,cursor:"pointer",fontSize:13,transition:"all 0.2s ease",userSelect:"none"},type:"button",children:"Save"}),e.jsx("button",{onClick:()=>{h(null),g("")},style:{padding:"4px 12px",background:"var(--surface)",color:"var(--text-secondary)",border:"none",borderRadius:20,cursor:"pointer",fontSize:13,transition:"all 0.2s ease"},type:"button",children:"Cancel"})]})]})]},o.id)})})})]})}function G({client:n}){const{state:b}=A(),d=v(l=>l.common.page_route),s=v(l=>l.common.calllog),[a,p]=i.useState("recent"),y=Array.isArray(s)?s:s?[s]:[];return d==="call"?e.jsx(J,{client:n}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",fontFamily:"Segoe UI, sans-serif",height:"100%",minHeight:0,background:"var(--background)",color:"var(--text-primary)"},children:[e.jsxs("div",{style:{display:"flex",gap:0,marginBottom:"12px",borderRadius:"8px",overflow:"hidden",background:"var(--surface)",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[e.jsx("button",{onClick:()=>p("recent"),style:P(a==="recent"),children:"Recent Calls"}),e.jsx("button",{onClick:()=>p("contacts"),style:P(a==="contacts"),children:"Contact List"})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"auto"},children:[a==="recent"&&e.jsx(H,{calls:y,client:n}),a==="contacts"&&e.jsx(q,{client:n})]})]})}const P=n=>({flex:1,padding:"12px",background:n?"var(--tab-button-active-bg)":"var(--tab-button-inactive-bg)",color:n?"#fff":"var(--tab-button-inactive-color)",fontWeight:n?600:400,fontSize:"16px",outline:"none",border:"none",borderBottom:n?"3px solid #0077ff":"3px solid transparent",cursor:"pointer",transition:"background-color 0.3s, color 0.3s, border-bottom 0.3s",borderRadius:"8px 8px 0 0",boxShadow:n?"0 2px 8px rgba(0,0,0,0.07)":"none",zIndex:n?1:0});export{G as default};
